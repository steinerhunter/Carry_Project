<div class="activity_feed_item" xmlns="http://www.w3.org/1999/html">
<% if activity_request_item.has_all_details %>
    <div class="has_all_details">
      <div class="bubbleInfo">
        <%= image_tag("has_all_details.png", class: "trigger") %>
        <div class="popup" style="height:20px; width:315px; margin-top:57px;">
          This request post has <b style="color:#279227">all</b> the necessary details!
          <div id="tail1" style="left:35px"></div>
          <div id="tail2" style="left:35px"></div>
        </div>
      </div>
    </div>
<% end %>
<div class="activity_feed_item_info">
<%= link_to activity_request_item.what, request_delivery_path(activity_request_item)  %>
<div class="status_and_created">
<div class="activity_status">
<% if activity_request_item.status == "Open" %>
    <div class="activity_content">
      <div class="activity_status_inner">
        Giveaway <br> Open
      </div>
      Your Giveaway has not been accepted by anyone so far.
      <div class="activity_created">
        Created: <%= activity_request_item.created_at.strftime("%d/%m/%Y") %>
      </div>
    </div>
<% elsif activity_request_item.status == "Taken" %>
    <% if activity_request_item.user == current_user  %>
        <div class="activity_content">
          <div class="activity_status_inner">
            Giveaway <br> Wanted
          </div>
          Your Giveaway is wanted by <b><%= link_to activity_request_item.confirmed_taker.name, activity_request_item.confirmed_taker  %></b>.
          <div class="activity_created">
            Updated: <%= activity_request_item.updated_at.strftime("%d/%m/%Y") %>
          </div>
        </div>
    <% elsif activity_request_item.confirmed_taker == current_user %>
        <div class="activity_content">
          <div class="activity_status_inner">
            Giveaway <br> Wanted
          </div>
          You want this Giveaway - no problem!<br>
          We just need  you to add where <b style="color:#f2ff5e">To</b> and select <b style="color:#f2ff5e">Delivery Option</b>.
          <div class="activity_created">
            Updated: <%= activity_request_item.updated_at.strftime("%d/%m/%Y") %>
          </div>
        </div>
    <% end  %>
<% elsif activity_request_item.status == "ReceiverConfirmed" %>
    <% if activity_request_item.user == current_user  %>
    <div class="activity_content">
      <div class="activity_status_inner">
        Transporter <br> Found
      </div>
      Your Giveaway is to be picked up by <b><%= link_to activity_request_item.confirmed_taker.name, activity_request_item.confirmed_taker  %></b>.
      <div class="activity_created">
        Updated: <%= activity_request_item.updated_at.strftime("%d/%m/%Y") %>
      </div>
    </div>
    <% elsif activity_request_item.confirmed_taker == current_user %>
        <div class="activity_content">
          <div class="activity_status_inner">
            Transporter <br> Found
          </div>
          Your details are confirmed, and you're good to go for the Pick up.<br>
          You should contact <b><%= link_to activity_request_item.user.name, activity_request_item.user %></b> to set the details.
          <div class="activity_created">
            Updated: <%= activity_request_item.updated_at.strftime("%d/%m/%Y") %>
          </div>
        </div>
    <% end  %>
<% elsif activity_request_item.status == "WaitingForTransporter" %>
    <div class="activity_content">
      <div class="activity_status_inner">
        Details <br> Confirmed
      </div>
      <b><%= link_to activity_request_item.confirmed_taker.name, activity_request_item.confirmed_taker  %></b> has confirmed his/her details for your Giveaway.<br>
      We're now locating a Transporter for the Pick up.
      <div class="activity_created">
        Updated: <%= activity_request_item.updated_at.strftime("%d/%m/%Y") %>
      </div>
    </div>
<% elsif activity_request_item.status == "Pending Confirmation" %>
    <% if activity_request_item.user == current_user  %>
        <div class="activity_content">
          <div class="activity_status_inner">
            Details <br> Confirmed
          </div>
          Someone has offered to pick up your Giveaway.<br>
          Now <b><%= link_to activity_request_item.confirmed_taker.name, activity_request_item.confirmed_taker  %></b> must confirm him/her.
          <div class="activity_created">
            Updated: <%= activity_request_item.updated_at.strftime("%d/%m/%Y") %>
          </div>
        </div>
    <% elsif activity_request_item.confirmed_taker == current_user %>
        <div class="activity_content">
          Your delivery request has been accepted!<br>
          After confirming someone, you will be redirected to PayPal for Preapproved Payment Authorization.
          <% @my_requests_accepted.each do |my_request_accepted| %>
              <% @users.each do |user| %>
                  <% if user.id == my_request_accepted.user_id &&
                          activity_request_item.id == my_request_accepted.request_delivery_id &&
                          my_request_accepted.confirmed == false %>

                  <% end  %>
              <% end  %>
          <% end  %>
        </div>
    <% else  %>
        <div class="activity_content">
          You've accepted this delivery request!<br>
          The creator must now confirm you as a transporter.
        </div>
    <% end  %>
<% elsif activity_request_item.status == "Confirmed" %>
    <% if activity_request_item.user == current_user %>
        <div class="activity_content">
          <div class="activity_status_inner">
            Transporter <br> Found
          </div>
          <b><%= link_to activity_request_item.accepted_request_confirmed.other_user_for_request.name,
                         activity_request_item.accepted_request_confirmed.other_user_for_request  %></b> is confirmed for picking up your Giveaway.
          <div class="activity_created">
            Updated: <%= activity_request_item.updated_at.strftime("%d/%m/%Y") %>
          </div>
        </div>
    <% elsif activity_request_item.confirmed_taker == current_user %>
        <div class="activity_content">
          You have confirmed this person for your delivery request! <br>
          You now must wait until he/she has completed the task.
          <div class="send_messages_to_users" style="background-color: #257b2a;border:1px solid;border-color: #000000;">
            <div class="needs_to_confirm">
              <% if activity_request_item.when.present? && (Time.now + 3.days > activity_request_item.when)%>
              <% else  %>
                  <div class="confirm_me" style="right:35px">
                    <div class="bubbleInfo">
                      <%=  link_to image_tag("Cancel.png"), pre_cancel_request_path(activity_request_item.accepted_request_confirmed.id), class:"modal-link trigger",
                                   "data-target" => "#myModal",
                                   "data-toggle" => "modal",
                                   "data-backdrop" => "static" %>
                      <div class="popup" style="height:20px; width:205px; margin-top:57px;">
                        <b style="color:#d05e0b;">Cancel</b> Preapproved payment.
                        <div id="tail1" style="left:36px"></div>
                        <div id="tail2" style="left:36px"></div>
                      </div>
                    </div>
                  </div>
              <% end  %>
              <b style="color:#f2ff5e"><%= link_to activity_request_item.accepted_request_confirmed.other_user_for_request.name,
                                                   activity_request_item.accepted_request_confirmed.other_user_for_request  %></b> is confirmed!
            </div>
          </div>
          <div class="send_messages_to_users" style="background-color: #7b337a;border:1px solid;border-color: #000000;">
            <div class="needs_to_confirm">
              Call transporter (<b style="color:#f2ff5e"><%= link_to activity_request_item.accepted_request_confirmed.other_user_for_request.name,
                                                                     activity_request_item.accepted_request_confirmed.other_user_for_request  %>
            </b>) at <b style="color:#f2ff5e"><%= activity_request_item.accepted_request_confirmed.other_user_for_request.phone %></b>.
            </div>
          </div>
        </div>
    <% elsif activity_request_item.accepted_request_confirmed.other_user_for_request == current_user  %>
        <div class="activity_content">
          You are confirmed for this delivery request! <br>
          After successfully completing it, click 'Complete Task'
          <div class="send_messages_to_users" style="background-color: #257b2a;border:1px solid;border-color: #000000;">
            <div class="needs_to_confirm">
              <div class="confirm_me" style="right:35px">
                <div class="bubbleInfo">
                  <%=  link_to image_tag("confirmed.png"), pre_complete_request_path(activity_request_item.accepted_request_confirmed.id), class:"modal-link trigger",
                               "data-target" => "#myModal",
                               "data-toggle" => "modal",
                               "data-backdrop" => "static" %>
                  <div class="popup" style="height:20px; width:185px; margin-top:57px;">
                    Mark request as <b style="color:#4dbeff;">Complete</b>!
                    <div id="tail1" style="left:36px"></div>
                    <div id="tail2" style="left:36px"></div>
                  </div>
                </div>
              </div>
              <div class="send_message" style="right:3px;">
                <div class="bubbleInfo">
                  <%=  link_to image_tag("send_message.png"),
                               {:controller => "conversations",
                                :action => "new",
                                :recipient_id => activity_request_item.user.id,
                                :request_delivery_id => activity_request_item.id  },
                               class: "trigger" %>
                  <div class="popup" style="height:20px; width:155px; margin-top:57px;">
                    <b style="color:#7ae292;">Send </b> user a message.
                    <div id="tail1" style="left:36px"></div>
                    <div id="tail2" style="left:36px"></div>
                  </div>
                </div>
              </div>
              <b style="color:#f2ff5e"><%= link_to activity_request_item.user.name, activity_request_item.user  %></b> has confirmed you!
            </div>
          </div>
          <div class="send_messages_to_users" style="background-color: #7b337a;border:1px solid;border-color: #000000;">
            <div class="needs_to_confirm">
              Call sender (<b style="color:#f2ff5e"><%= link_to activity_request_item.user.name, activity_request_item.user  %></b>) at <b style="color:#f2ff5e"><%= activity_request_item.user.phone %></b>.
            </div>
          </div>
          <% if activity_request_item.sending_person.present? && activity_request_item.sending_phone.present? %>
              <div class="send_messages_to_users" style="background-color: #7b337a;border:1px solid;border-color: #000000;">
                <div class="needs_to_confirm">
                  Call Sending Person (<b style="color:#f2ff5e"><%= activity_request_item.sending_person %></b>) at <b style="color:#f2ff5e"><%= activity_request_item.sending_phone %></b>.
                </div>
              </div>
          <% end %>
          <% if activity_request_item.receiving_person.present? && activity_request_item.receiving_phone.present? %>
              <div class="send_messages_to_users" style="background-color: #7b337a;border:1px solid;border-color: #000000;">
                <div class="needs_to_confirm">
                  Call Receiving Person (<b style="color:#f2ff5e"><%= activity_request_item.receiving_person %></b>) at <b style="color:#f2ff5e"><%= activity_request_item.receiving_phone %></b>.
                </div>
              </div>
          <% end %>
        </div>
    <% else  %>
        <br>
        <div class="send_messages_to_users" style="background-color: #0b5aff;">
          <div class="needs_to_confirm">
            <b style="color:#f2ff5e"><%= link_to activity_request_item.user.name, activity_request_item.user  %></b> has confirmed another user!
          </div>
        </div>
    <% end  %>
<% elsif activity_request_item.status == "Complete" %>
    <% if activity_request_item.delivery_type == "myself" %>
        <% if activity_request_item.user == current_user %>
            <div class="activity_content">
              <div class="activity_status_inner">
                Item <br> Received
              </div>
              Your Giveaway has been picked up by <b><%= link_to activity_request_item.confirmed_taker.name, activity_request_item.confirmed_taker  %></b>.
              <div class="activity_created">
                Updated: <%= activity_request_item.updated_at.strftime("%d/%m/%Y") %>
              </div>
            </div>
        <% elsif activity_request_item.confirmed_taker == current_user %>
            <div class="activity_content">
              <div class="activity_status_inner">
                Item <br> Received
              </div>
              This Giveaway has been picked up by <b><%= link_to activity_request_item.accepted_request_confirmed.other_user_for_request.name, activity_request_item.accepted_request_confirmed.other_user_for_request %></b>
              and delivered to <b><%= link_to activity_request_item.confirmed_taker.name, activity_request_item.confirmed_taker  %></b>.
              <div class="activity_created">
                Updated: <%= activity_request_item.updated_at.strftime("%d/%m/%Y") %>
              </div>
            </div>
        <% end  %>
    <% elsif activity_request_item.delivery_type == "senddme" %>
        <div class="activity_content">
          <div class="activity_status_inner">
            Item <br> Received
          </div>
          Your Giveaway has been picked up by <b><%= link_to activity_request_item.accepted_request_confirmed.other_user_for_request.name, activity_request_item.accepted_request_confirmed.other_user_for_request %></b>
          and delivered to <b><%= link_to activity_request_item.confirmed_taker.name, activity_request_item.confirmed_taker  %></b>.
          <div class="activity_created">
            Updated: <%= activity_request_item.updated_at.strftime("%d/%m/%Y") %>
          </div>
        </div>
    <% end  %>
    <% if activity_request_item.user == current_user %>

    <% elsif activity_request_item.accepted_request_confirmed.other_user_for_request == current_user  %>

    <% end  %>
<% elsif activity_request_item.status == "TransporterReviewed" %>
    <% if activity_request_item.user == current_user %>
        <div class="activity_content">
          <div class="activity_status_inner">
            Item <br> Received
          </div>
          Your Giveaway has been picked up by <b><%= link_to activity_request_item.confirmed_taker.name, activity_request_item.confirmed_taker  %></b>.
          <div class="activity_created">
            Updated: <%= activity_request_item.updated_at.strftime("%d/%m/%Y") %>
          </div>
        </div>
    <% elsif activity_request_item.confirmed_taker == current_user %>
    <% end  %>
<% end  %>
</div>
</div>
</div>
</div>
